<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í”½ì…€ ë§µ í…ŒìŠ¤íŠ¸ - ë§ˆì¹´ë¡±íŒ©í† ë¦¬</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸš—</text></svg>">
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, sans-serif;
            color: white;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .test-controls {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
        }
        
        .test-controls button {
            background: #4A90E2;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            margin: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s ease;
        }
        
        .test-controls button:hover {
            background: #357ABD;
            transform: translateY(-1px);
        }
        
        .test-controls button.danger {
            background: #E74C3C;
        }
        
        .test-controls button.danger:hover {
            background: #C0392B;
        }
        
        .map-container {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            backdrop-filter: blur(10px);
            text-align: center;
        }
        
        #pixiCanvas {
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            background: #2C3E50;
        }
        
        .info {
            margin-top: 20px;
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 8px;
            font-size: 14px;
        }
        
        .area-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }
        
        .area-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px;
            border-radius: 6px;
            text-align: center;
        }
        
        .area-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin: 0 auto 5px;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¢ í”½ì…€ ì•„íŠ¸ ì‚¬ë¬´ì‹¤ ë§µ í…ŒìŠ¤íŠ¸</h1>
            <p>PixiJSë¥¼ ì‚¬ìš©í•œ 10x10 íƒ€ì¼ ë§µ ë Œë”ë§ í…ŒìŠ¤íŠ¸</p>
        </div>
        
        <div class="test-controls">
            <h3>ğŸ® í…ŒìŠ¤íŠ¸ ì»¨íŠ¸ë¡¤</h3>
            <button onclick="createMap()">ë§µ ìƒì„±</button>
            <button onclick="destroyMap()" class="danger">ë§µ ì œê±°</button>
            <button onclick="showMapInfo()">ë§µ ì •ë³´</button>
            <button onclick="toggleFullscreen()">ì „ì²´í™”ë©´</button>
            
            <hr style="margin: 15px 0; border: none; border-top: 1px solid rgba(255,255,255,0.2);">
            
            <h3>ğŸ‘¥ ìºë¦­í„° ì»¨íŠ¸ë¡¤</h3>
            <button onclick="createCharacters()">ìºë¦­í„° ìƒì„±</button>
            <button onclick="removeCharacters()" class="danger">ìºë¦­í„° ì œê±°</button>
            <button onclick="showCharacterInfo()">ìºë¦­í„° ì •ë³´</button>
            <button onclick="moveRandomCharacter()">ëœë¤ ì´ë™</button>
        </div>
        
        <div class="map-container">
            <h3>ğŸ—ºï¸ ë§µ ë Œë”ë§ ì˜ì—­</h3>
            <div id="pixiContainer"></div>
        </div>
        
        <div class="info">
            <h3>ğŸ“‹ ë§µ ì •ë³´</h3>
            <p><strong>í¬ê¸°:</strong> 10x10 íƒ€ì¼ (320x320 í”½ì…€)</p>
            <p><strong>íƒ€ì¼ í¬ê¸°:</strong> 32x32 í”½ì…€</p>
            <p><strong>êµ¬ì—­:</strong> 4ê°œ êµ¬ì—­ (ë¯¸íŒ…ë£¸, ì¹´í˜í…Œë¦¬ì•„, ì¢Œì„A, ì¢Œì„B)</p>
            
            <div class="area-info">
                <div class="area-item">
                    <div class="area-color" style="background: #4A90E2;"></div>
                    <strong>ë¯¸íŒ…ë£¸</strong><br>
                    <small>êµ¬ì—­ 1</small>
                </div>
                <div class="area-item">
                    <div class="area-color" style="background: #7ED321;"></div>
                    <strong>ì¹´í˜í…Œë¦¬ì•„</strong><br>
                    <small>êµ¬ì—­ 2</small>
                </div>
                <div class="area-item">
                    <div class="area-color" style="background: #F5A623;"></div>
                    <strong>ì¢Œì„A</strong><br>
                    <small>êµ¬ì—­ 3</small>
                </div>
                <div class="area-item">
                    <div class="area-color" style="background: #BD10E0;"></div>
                    <strong>ì¢Œì„B</strong><br>
                    <small>êµ¬ì—­ 4</small>
                </div>
            </div>
        </div>
    </div>

    <!-- PixiJS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/7.3.2/pixi.min.js"></script>
    
    <!-- í”½ì…€ ë§µ ëª¨ë“ˆ -->
    <script src="js/pixel-map.js"></script>
    
    <!-- ìºë¦­í„° ì‹œìŠ¤í…œ -->
    <script src="js/character-system.js"></script>
    
    <script>
        // PixiJS ì•± ì´ˆê¸°í™”
        let app;
        
        function initPixiApp() {
            try {
                if (app) {
                    app.destroy(true);
                }
                
                // DOM ì»¨í…Œì´ë„ˆ í™•ì¸
                const container = document.getElementById('pixiContainer');
                if (!container) {
                    console.error('âŒ pixiContainerë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                    return false;
                }
                
                // ê¸°ì¡´ ìº”ë²„ìŠ¤ ì œê±°
                const existingCanvas = container.querySelector('canvas');
                if (existingCanvas) {
                    existingCanvas.remove();
                }
                
                // ìˆ˜ë™ìœ¼ë¡œ ìº”ë²„ìŠ¤ ìƒì„±
                const canvas = document.createElement('canvas');
                canvas.width = 400;
                canvas.height = 400;
                canvas.style.border = '2px solid rgba(255, 255, 255, 0.3)';
                canvas.style.borderRadius = '8px';
                canvas.style.background = '#2C3E50';
                
                // DOMì— ìº”ë²„ìŠ¤ ì¶”ê°€
                container.appendChild(canvas);
                
                // PixiJS ì•± ìƒì„± (ê¸°ì¡´ ìº”ë²„ìŠ¤ ì‚¬ìš©)
                app = new PIXI.Application({
                    view: canvas,
                    width: 400,
                    height: 400,
                    backgroundColor: 0x2C3E50,
                    antialias: false,
                    resolution: 1
                });
                
                // ì „ì—­ app ê°ì²´ ì„¤ì •
                window.app = app;
                
                console.log('ğŸ® PixiJS ì•± ì´ˆê¸°í™” ì™„ë£Œ');
                return true;
                
            } catch (error) {
                console.error('âŒ PixiJS ì•± ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
                return false;
            }
        }
        
        // ë§µ ìƒì„±
        async function createMap() {
            try {
                console.log('ğŸ—ï¸ ë§µ ìƒì„± ì‹œì‘...');
                
                // PixiJS ì•± ì´ˆê¸°í™”
                if (!app) {
                    const initSuccess = initPixiApp();
                    if (!initSuccess) {
                        throw new Error('PixiJS ì•± ì´ˆê¸°í™” ì‹¤íŒ¨');
                    }
                }
                
                // app ê°ì²´ í™•ì¸
                if (!app || !app.stage) {
                    throw new Error('PixiJS ì•±ê°€ ì œëŒ€ë¡œ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤');
                }
                
                // PixelMapManager ì´ˆê¸°í™”
                if (!window.pixelMapManager) {
                    window.pixelMapManager = new PixelMapManager(app);
                    console.log('ğŸ—ºï¸ PixelMapManager ì´ˆê¸°í™” ì™„ë£Œ');
                }
                
                // ë§µ ìƒì„±
                const mapContainer = await window.createOfficeMap();
                console.log('âœ… ë§µ ìƒì„± ì™„ë£Œ:', mapContainer);
                
                // ë§µì„ ì¤‘ì•™ì— ë°°ì¹˜
                if (mapContainer) {
                    const centerX = (app.screen.width - mapContainer.width) / 2;
                    const centerY = (app.screen.height - mapContainer.height) / 2;
                    mapContainer.position.set(centerX, centerY);
                    console.log('ğŸ“ ë§µ ì¤‘ì•™ ë°°ì¹˜ ì™„ë£Œ:', centerX, centerY);
                }
                
                // ì• ë‹ˆë©”ì´ì…˜ ë£¨í”„ ì‹œì‘
                startAnimationLoop();
                
            } catch (error) {
                console.error('âŒ ë§µ ìƒì„± ì‹¤íŒ¨:', error);
                alert('ë§µ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }
        
        // ë§µ ì œê±°
        function destroyMap() {
            window.removeOfficeMap();
            console.log('ğŸ—‘ï¸ ë§µ ì œê±° ì™„ë£Œ');
        }
        
        // ë§µ ì •ë³´ í‘œì‹œ
        function showMapInfo() {
            const info = window.getMapInfo();
            if (info) {
                console.log('ğŸ“‹ ë§µ ì •ë³´:', info);
                alert(`ë§µ ì •ë³´:\n- í¬ê¸°: ${info.width}x${info.height}\n- íƒ€ì¼ í¬ê¸°: ${info.tileSize}x${info.tileSize}\n- ì´ íƒ€ì¼ ìˆ˜: ${info.totalTiles}\n- êµ¬ì—­ ìˆ˜: ${Object.keys(info.areas).length}`);
            } else {
                alert('ë§µì´ ìƒì„±ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
            }
        }
        
        // ì „ì²´í™”ë©´ í† ê¸€
        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                document.exitFullscreen();
            }
        }
        
        // ìºë¦­í„° ìƒì„±
        async function createCharacters() {
            try {
                console.log('ğŸ‘¥ ìºë¦­í„° ìƒì„± ì‹œì‘...');
                
                // PixiJS ì•± í™•ì¸
                if (!app) {
                    throw new Error('PixiJS ì•±ì´ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ë¨¼ì € ë§µì„ ìƒì„±í•´ì£¼ì„¸ìš”.');
                }
                
                // ìºë¦­í„° ë§¤ë‹ˆì € ì´ˆê¸°í™”
                if (!window.characterManager) {
                    window.createCharacterManager(app);
                    console.log('ğŸ‘¥ ìºë¦­í„° ë§¤ë‹ˆì € ì´ˆê¸°í™” ì™„ë£Œ');
                }
                
                // ìƒ˜í”Œ ìºë¦­í„°ë“¤ ìƒì„±
                await window.createSampleCharacters();
                console.log('âœ… ìºë¦­í„° ìƒì„± ì™„ë£Œ');
                
            } catch (error) {
                console.error('âŒ ìºë¦­í„° ìƒì„± ì‹¤íŒ¨:', error);
                alert('ìºë¦­í„° ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }
        
        // ìºë¦­í„° ì œê±°
        function removeCharacters() {
            if (window.characterManager) {
                window.characterManager.removeAllCharacters();
                console.log('ğŸ—‘ï¸ ìºë¦­í„° ì œê±° ì™„ë£Œ');
            } else {
                alert('ìºë¦­í„° ë§¤ë‹ˆì €ê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
            }
        }
        
        // ìºë¦­í„° ì •ë³´ í‘œì‹œ
        function showCharacterInfo() {
            const characters = window.getCharactersInfo();
            if (characters.length > 0) {
                console.log('ğŸ‘¥ ìºë¦­í„° ì •ë³´:', characters);
                const infoText = characters.map(char => 
                    `${char.name} (${char.description})\n- ìœ„ì¹˜: (${char.position.x}, ${char.position.y})\n- ì´ë™ì¤‘: ${char.isMoving ? 'ì˜ˆ' : 'ì•„ë‹ˆì˜¤'}`
                ).join('\n\n');
                alert(`ìºë¦­í„° ì •ë³´ (${characters.length}ëª…):\n\n${infoText}`);
            } else {
                alert('ìºë¦­í„°ê°€ ìƒì„±ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
            }
        }
        
        // ëœë¤ ìºë¦­í„° ì´ë™
        function moveRandomCharacter() {
            if (!window.characterManager || window.characterManager.characters.length === 0) {
                alert('ìºë¦­í„°ê°€ ìƒì„±ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                return;
            }
            
            const characters = window.characterManager.characters;
            const randomCharacter = characters[Math.floor(Math.random() * characters.length)];
            
            // ëœë¤ ìœ„ì¹˜ ìƒì„± (ë§µ ë‚´ë¶€)
            const randomX = Math.random() * 320;
            const randomY = Math.random() * 320;
            
            window.moveCharacter(randomCharacter, randomX, randomY);
            console.log(`ğŸ² ëœë¤ ì´ë™: ${randomCharacter.name} â†’ (${randomX}, ${randomY})`);
        }
        
        // ì• ë‹ˆë©”ì´ì…˜ ë£¨í”„ (ìºë¦­í„° ì´ë™ìš©)
        function startAnimationLoop() {
            if (app && window.characterManager) {
                app.ticker.add(() => {
                    window.characterManager.update();
                });
                console.log('ğŸ”„ ì• ë‹ˆë©”ì´ì…˜ ë£¨í”„ ì‹œì‘');
            }
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        window.addEventListener('load', () => {
            console.log('ğŸš€ í”½ì…€ ë§µ í…ŒìŠ¤íŠ¸ í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ');
            
            // PixiJS ë¡œë“œ í™•ì¸
            if (typeof PIXI !== 'undefined') {
                console.log('âœ… PixiJS ë¡œë“œ í™•ì¸ë¨');
                console.log('ğŸ“¦ PIXI ë²„ì „:', PIXI.VERSION);
                
                // DOM ìš”ì†Œ í™•ì¸
                const container = document.getElementById('pixiContainer');
                if (container) {
                    console.log('âœ… pixiContainer ìš”ì†Œ í™•ì¸ë¨');
                } else {
                    console.error('âŒ pixiContainer ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                }
            } else {
                console.error('âŒ PixiJS ë¡œë“œ ì‹¤íŒ¨');
                alert('PixiJS ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.');
            }
        });
    </script>
</body>
</html> 